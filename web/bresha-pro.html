<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Green Dot PRO - Advanced Teams Keeper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #0a0e27; --card: #0f172a; --accent: #22c55e;
      --accent-dim: #16a34a; --text: #e5e7eb; --text-dim: #9ca3af;
      --border: rgba(148,163,184,0.3); --shadow: rgba(0,0,0,0.5);
    }
    body {
      min-height: 100vh; background: linear-gradient(135deg, var(--bg) 0%, #020617 100%);
      color: var(--text); font-family: 'Segoe UI', system-ui, sans-serif;
      display: flex; align-items: center; justify-content: center; padding: 20px; overflow-x: hidden;
    }
    .stars { position: fixed; inset: 0; pointer-events: none; background-image: radial-gradient(1px 1px at 10% 20%, #ffffff44 0%, transparent 50%), radial-gradient(2px 2px at 80% 30%, #ffffff33 0%, transparent 50%); opacity: 0.3; animation: twinkle 12s ease-in-out infinite; z-index: 0; }
    @keyframes twinkle { 0% { opacity: 0.2; } 50% { opacity: 0.5; } 100% { opacity: 0.2; } }
    .container { position: relative; z-index: 1; max-width: 1400px; width: 100%; }
    .header { background: rgba(15,23,42,0.8); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 20px; padding: 24px; margin-bottom: 20px; box-shadow: 0 25px 50px var(--shadow); }
    h1 { font-size: 2rem; font-weight: bold; display: flex; align-items: center; gap: 12px; margin-bottom: 8px; letter-spacing: 0.05em; }
    .dot-anim { width: 14px; height: 14px; border-radius: 999px; background: linear-gradient(135deg, #bbf7d0, var(--accent)); box-shadow: 0 0 20px var(--accent); animation: pulse 1.5s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }
    .subtitle { color: var(--text-dim); font-size: 0.95rem; margin-top: 6px; }
    .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 20px; }
    .panel { background: rgba(15,23,42,0.7); border: 1px solid var(--border); border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(15,23,42,0.5); }
    .panel-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
    .btn { border-radius: 10px; border: none; padding: 10px 20px; font-size: 0.95rem; cursor: pointer; transition: all 0.2s; font-weight: 500; }
    .btn-primary { background: linear-gradient(135deg, var(--accent), var(--accent-dim)); color: #022c22; box-shadow: 0 8px 20px rgba(34,197,94,0.3); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(34,197,94,0.5); }
    .btn-secondary { background: rgba(30,64,175,0.4); color: var(--text); border: 1px solid rgba(129,140,148,0.6); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .timer-presets { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 12px; }
    .preset-btn { padding: 8px; border-radius: 8px; border: 1px solid var(--border); background: rgba(15,23,42,0.9); color: var(--text); font-size: 0.85rem; cursor: pointer; transition: all 0.2s; }
    .preset-btn:hover { border-color: var(--accent); background: rgba(34,197,94,0.1); }
    .preset-btn.active { background: rgba(34,197,94,0.25); border-color: var(--accent); color: var(--accent); }
    .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 16px; }
    .stat-box { background: rgba(30,64,175,0.2); border: 1px solid rgba(129,140,148,0.5); border-radius: 10px; padding: 12px; text-align: center; }
    .stat-value { font-size: 1.4rem; font-weight: bold; color: var(--accent); }
    .stat-label { font-size: 0.75rem; color: var(--text-dim); margin-top: 4px; text-transform: uppercase; letter-spacing: 0.08em; }
    .log-display { background: rgba(0,0,0,0.4); border-radius: 10px; padding: 12px; max-height: 250px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 0.8rem; color: #a5b4fc; }
    .log-line { padding: 3px 0; border-bottom: 1px solid rgba(148,163,184,0.1); }
    .log-line:last-child { border-bottom: none; }
    .log-time { color: #9ca3af; margin-right: 8px; }
    .log-tag { display: inline-block; background: rgba(34,197,94,0.2); color: var(--accent); font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-left: 8px; font-weight: bold; }
    @media (max-width: 1000px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="stars"></div>
  <div class="container">
    <div class="header">
      <h1><span class="dot-anim"></span>GREEN DOT PRO</h1>
      <p class="subtitle">Advanced keep-alive engine: Wake Lock + RAF 60fps + Silent Audio + Smart Timers + Desktop Notifications + Activity Stats</p>
    </div>
    <div class="grid">
      <div class="panel">
        <div class="panel-title">‚öô Control Center</div>
        <div style="display: flex; gap: 10px; margin-bottom: 12px;">
          <button id="startBtn" class="btn btn-primary" style="flex: 1;">‚ñ∂ Start</button>
          <button id="stopBtn" class="btn btn-secondary" style="flex: 1;" disabled>‚ñ† Stop</button>
        </div>
        <div style="margin-bottom: 12px;">
          <label style="display: block; font-size: 0.85rem; color: var(--text-dim); margin-bottom: 6px;">Quick Presets:</label>
          <div class="timer-presets">
            <button class="preset-btn" data-minutes="25">25m</button>
            <button class="preset-btn" data-minutes="50">50m</button>
            <button class="preset-btn" data-minutes="120">2h</button>
            <button class="preset-btn" data-minutes="480">8h</button>
          </div>
        </div>
        <div style="margin-bottom: 12px;">
          <label style="display: block; font-size: 0.85rem; color: var(--text-dim); margin-bottom: 6px;">Custom Duration (min):</label>
          <div style="display: flex; gap: 8px;">
            <input id="customMinutes" type="number" min="1" max="1440" value="60" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid var(--border); background: rgba(15,23,42,0.9); color: var(--text); font-size: 0.9rem;" />
            <button id="setCustomBtn" class="btn btn-secondary">Set</button>
          </div>
        </div>
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
          <div style="font-size: 0.85rem; color: var(--text-dim);">Current Session:</div>
          <div style="font-size: 1.8rem; font-weight: bold; color: var(--accent); margin-top: 4px;" id="timerDisplay">00:00:00</div>
          <div style="font-size: 0.75rem; color: var(--text-dim); margin-top: 4px;" id="timerMode">Waiting for start...</div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-title">üìä Statistics</div>
        <div class="stats">
          <div class="stat-box">
            <div class="stat-value" id="totalHours">0</div>
            <div class="stat-label">Total Hours</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="sessionCount">0</div>
            <div class="stat-label">Sessions</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="screenKept">0</div>
            <div class="stat-label">Screens Kept</div>
          </div>
        </div>
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border);">
          <div style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 6px;">System Status:</div>
          <div style="font-size: 0.8rem; color: var(--accent); line-height: 1.8;">
            <div>‚úì Wake Lock: <span id="wlStatus">Ready</span></div>
            <div>‚úì Audio Context: <span id="acStatus">Ready</span></div>
            <div>‚úì RAF Loop: <span id="rafStatus">Ready</span></div>
            <div>‚úì Notifications: <span id="notifStatus">Ready</span></div>
          </div>
        </div>
      </div>
    </div>
    <div class="panel" style="margin-top: 20px;">
      <div class="panel-title">üìù Activity Log</div>
      <div class="log-display" id="logDisplay"></div>
    </div>
  </div>
  <canvas id="keepCanvas" style="position: fixed; width: 1px; height: 1px; opacity: 0; left: -1px; top: -1px; pointer-events: none;"></canvas>

  <script>
    const APP_STATE = {
      running: false, startTime: null, sessionDuration: null, wakeLock: null, audioCtx: null, audioSource: null,
      rafId: null, timerInterval: null, microtaskInterval: null, notificationShown: false
    };

    const UI = {
      startBtn: document.getElementById('startBtn'), stopBtn: document.getElementById('stopBtn'),
      timerDisplay: document.getElementById('timerDisplay'), timerMode: document.getElementById('timerMode'),
      logDisplay: document.getElementById('logDisplay'), customMinutes: document.getElementById('customMinutes'),
      presetBtns: document.querySelectorAll('.preset-btn'), setCustomBtn: document.getElementById('setCustomBtn'),
      totalHours: document.getElementById('totalHours'), sessionCount: document.getElementById('sessionCount'),
      screenKept: document.getElementById('screenKept'), wlStatus: document.getElementById('wlStatus'),
      acStatus: document.getElementById('acStatus'), rafStatus: document.getElementById('rafStatus'),
      notifStatus: document.getElementById('notifStatus')
    };

    const STATS = JSON.parse(localStorage.getItem('greenDotStats') || '{"totalSeconds": 0, "sessions": 0}');

    function log(msg, tag = 'INFO') {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('ro-RO', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
      const div = document.createElement('div');
      div.className = 'log-line';
      div.innerHTML = `<span class="log-time">${timeStr}</span><span>${msg}</span><span class="log-tag">${tag}</span>`;
      UI.logDisplay.prepend(div);
      while (UI.logDisplay.children.length > 100) UI.logDisplay.removeChild(UI.logDisplay.lastChild);
    }

    function updateStats() {
      const hours = (STATS.totalSeconds / 3600).toFixed(1);
      UI.totalHours.textContent = hours;
      UI.sessionCount.textContent = STATS.sessions;
      UI.screenKept.textContent = Math.floor(STATS.totalSeconds / 3600 / 8); // rough estimate
      localStorage.setItem('greenDotStats', JSON.stringify(STATS));
    }

    function formatTime(ms) {
      const totalSecs = Math.floor(ms / 1000);
      return `${String(Math.floor(totalSecs / 3600)).padStart(2, '0')}:${String(Math.floor((totalSecs % 3600) / 60)).padStart(2, '0')}:${String(totalSecs % 60).padStart(2, '0')}`;
    }

    async function requestWakeLock() {
      if (!('wakeLock' in navigator)) { log('Wake Lock not available', 'WARN'); UI.wlStatus.textContent = 'Unavailable'; return; }
      try {
        APP_STATE.wakeLock = await navigator.wakeLock.request('screen');
        log('Wake Lock activated', 'WAKELOCK');
        UI.wlStatus.textContent = '‚úì Active';
        APP_STATE.wakeLock.addEventListener('release', () => log('Wake Lock released (tab backgrounded)', 'WAKELOCK'));
      } catch (err) { log('Wake Lock error: ' + err.message, 'ERROR'); UI.wlStatus.textContent = 'Error'; }
    }

    async function releaseWakeLock() {
      if (APP_STATE.wakeLock) { try { await APP_STATE.wakeLock.release(); log('Wake Lock released', 'WAKELOCK'); } catch (e) { } APP_STATE.wakeLock = null; UI.wlStatus.textContent = 'Idle'; }
    }

    async function startAudioContext() {
      try {
        if (!APP_STATE.audioCtx) APP_STATE.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (APP_STATE.audioCtx.state === 'suspended') await APP_STATE.audioCtx.resume();
        if (!APP_STATE.audioSource) {
          const osc = APP_STATE.audioCtx.createOscillator();
          const gain = APP_STATE.audioCtx.createGain();
          osc.frequency.value = 440; gain.gain.setValueAtTime(0.00001, APP_STATE.audioCtx.currentTime);
          osc.connect(gain); gain.connect(APP_STATE.audioCtx.destination);
          osc.start(); APP_STATE.audioSource = osc;
        }
        log('Audio Context active', 'MEDIA'); UI.acStatus.textContent = '‚úì Active';
      } catch (err) { log('Audio error: ' + err.message, 'WARN'); UI.acStatus.textContent = 'Error'; }
    }

    async function stopAudioContext() {
      if (APP_STATE.audioSource) { try { APP_STATE.audioSource.stop(); APP_STATE.audioSource.disconnect(); APP_STATE.audioSource = null; } catch (e) { } }
      if (APP_STATE.audioCtx) { try { await APP_STATE.audioCtx.close(); } catch (e) { } APP_STATE.audioCtx = null; }
      UI.acStatus.textContent = 'Idle';
    }

    function startRafLoop() {
      const canvas = document.getElementById('keepCanvas');
      const ctx = canvas ? canvas.getContext('2d') : null;
      function loop() {
        if (ctx) { ctx.fillStyle = `hsl(${Date.now() % 360}, 50%, 50%)`; ctx.fillRect(0, 0, 1, 1); }
        APP_STATE.rafId = requestAnimationFrame(loop);
      }
      loop();
      log('RAF 60fps loop active', 'RAF'); UI.rafStatus.textContent = '‚úì Running';
    }

    function stopRafLoop() {
      if (APP_STATE.rafId) { cancelAnimationFrame(APP_STATE.rafId); APP_STATE.rafId = null; }
      UI.rafStatus.textContent = 'Idle';
    }

    function startMicroactivity() {
      APP_STATE.microtaskInterval = setInterval(() => {
        // Virtual keyboard bursts
        const evt = new KeyboardEvent('keydown', { key: 'Shift', code: 'ShiftLeft' });
        document.dispatchEvent(evt);
        // Virtual mouse micro-movement
        const mEvt = new MouseEvent('mousemove', { clientX: Math.random() * 10, clientY: Math.random() * 10 });
        window.dispatchEvent(mEvt);
      }, 15000); // Every 15 seconds
      log('Micro-activity simulation started', 'MICRO');
    }

    function stopMicroactivity() {
      if (APP_STATE.microtaskInterval) { clearInterval(APP_STATE.microtaskInterval); APP_STATE.microtaskInterval = null; }
    }

    function showNotification() {
      if (!APP_STATE.notificationShown && 'Notification' in window) {
        if (Notification.permission === 'granted') {
          new Notification('Green Dot Active', { body: 'Your screen will stay awake!', icon: 'data:image/svg+xml,...' });
          APP_STATE.notificationShown = true;
        } else if (Notification.permission !== 'denied') {
          Notification.requestPermission().then(perm => { if (perm === 'granted') showNotification(); });
        }
      }
      UI.notifStatus.textContent = '‚úì Enabled';
    }

    async function startRitual() {
      if (APP_STATE.running) return;
      APP_STATE.running = true;
      UI.startBtn.disabled = true; UI.stopBtn.disabled = false;
      APP_STATE.startTime = Date.now();
      
      await requestWakeLock();
      await startAudioContext();
      startRafLoop();
      startMicroactivity();
      showNotification();

      UI.timerMode.textContent = APP_STATE.sessionDuration ? `Running: ${APP_STATE.sessionDuration}m session` : 'Running indefinitely';

      APP_STATE.timerInterval = setInterval(() => {
        const elapsed = Date.now() - APP_STATE.startTime;
        UI.timerDisplay.textContent = formatTime(elapsed);
        
        if (APP_STATE.sessionDuration && elapsed >= APP_STATE.sessionDuration * 60 * 1000) {
          stopRitual();
        }
      }, 1000);

      log(`Ritual START - ${APP_STATE.sessionDuration || 'indefinite'} mode`, 'START');
    }

    async function stopRitual() {
      if (!APP_STATE.running) return;
      APP_STATE.running = false;
      
      if (APP_STATE.timerInterval) clearInterval(APP_STATE.timerInterval);
      stopRafLoop();
      stopMicroactivity();
      await releaseWakeLock();
      await stopAudioContext();

      const elapsed = Date.now() - APP_STATE.startTime;
      STATS.totalSeconds += elapsed / 1000;
      STATS.sessions += 1;
      updateStats();

      UI.startBtn.disabled = false; UI.stopBtn.disabled = true;
      UI.timerDisplay.textContent = '00:00:00';
      UI.timerMode.textContent = 'Waiting for start...';

      log(`Ritual STOP - Session: ${formatTime(elapsed)}`, 'STOP');
    }

    UI.presetBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        UI.presetBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        APP_STATE.sessionDuration = parseInt(btn.dataset.minutes);
        log(`Preset selected: ${btn.dataset.minutes}m`, 'PRESET');
      });
    });

    UI.setCustomBtn.addEventListener('click', () => {
      const mins = parseInt(UI.customMinutes.value);
      if (mins > 0 && mins <= 1440) {
        APP_STATE.sessionDuration = mins;
        UI.presetBtns.forEach(b => b.classList.remove('active'));
        log(`Custom duration set: ${mins}m`, 'CUSTOM');
      }
    });

    UI.startBtn.addEventListener('click', startRitual);
    UI.stopBtn.addEventListener('click', stopRitual);

    updateStats();
    log('Green Dot PRO Ready', 'INIT');
  </script>
</body>
</html>
